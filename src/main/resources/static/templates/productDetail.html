<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>여행 계획 상세</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/productDetail.css">
    <link rel="icon" href="/static/images/icon/product.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
<header>
    <nav>
        <div class="logo">Viaje</div>
        <ul class="nav-links">
            <li><a href="/">Home</a></li>
            <li><a href="/plans">Plans</a></li>
            <li><a href="/Modify">Modify</a></li>
        </ul>
    </nav>
</header>

<main>
    <div class="container">
        <article th:if="${selectedPlan}">
            <h2 th:text="${selectedPlan.title}">여행 계획 제목</h2>

            <section class="plan-details">
                <div class="detail-item">
                    <i class="fas fa-globe"></i>
                    <p><strong>국가:</strong> <span th:text="${selectedPlan.nation}"></span></p>
                </div>
                <div class="detail-item">
                    <i class="fas fa-user"></i>
                    <p><strong>작성자:</strong> <span th:text="${selectedPlan.user.userName}"></span></p>
                </div>
                <div class="detail-item">
                    <i class="fas fa-calendar-alt"></i>
                    <p><strong>작성일:</strong> <span th:text="${#temporals.format(selectedPlan.createdAt, 'yyyy-MM-dd HH:mm')}"></span></p>
                </div>
                <div class="detail-item">
                    <i class="fas fa-edit"></i>
                    <p><strong>최종 수정일:</strong> <span th:text="${#temporals.format(selectedPlan.updatedAt, 'yyyy-MM-dd HH:mm')}"></span></p>
                </div>
            </section>
            <section class="plan-status">
                <div class="detail-item">
                    <i class="fas fa-shopping-cart"></i>
                    <p><strong>판매 수:</strong> <span th:text="${selectedPlan.sold}"></span></p>
                </div>
            </section>
            <section class="plan-status">
                <div class="detail-item">
                    <i class="fas fa-info-circle"></i>
                    <p><strong>상태:</strong> <span th:text="${selectedPlan.status}"></span></p>
                </div>
            </section>

            <section class="plan-content">
                <h3>상세 내용</h3>
                <div th:utext="${selectedPlan.detail}"></div>
            </section>

            <section class="plan-images">
                <h3>첨부 이미지</h3>
                <div class="image-gallery" th:if="${not #lists.isEmpty(selectedPlan.imagePaths)}">
                    <div th:each="imagePath : ${selectedPlan.imagePaths}" class="image-item">
                        <img th:src="@{'../uploads/plan/'+ ${imagePath}}" th:alt="'uploads/plan/'+ ${imagePath}">
                    </div>
                </div>
                <p th:if="${#lists.isEmpty(selectedPlan.imagePaths)}">첨부된 이미지가 없습니다.</p>
            </section>

            <section class="add-to-cart">
                <form th:action="@{/cart/add}" method="post">
                    <input type="hidden" name="planId" th:value="${selectedPlan.planId}">
                    <button type="submit" class="btn-add-to-cart">
                        <i class="fas fa-cart-plus"></i> 카트에 추가
                    </button>
                </form>
            </section>

<!--            <div class="place-item">-->
<!--                <div class="place-number">1</div>-->
<!--                <div class="place-info">-->
<!--                    <div class="place-name">실크 센세 호이 안 리버 리조트</div>-->
<!--                    <div class="place-category">4성급 · 호이안</div>-->
<!--                </div>-->
<!--                <button class="btn-review">리뷰쓰기</button>-->
<!--            </div>-->
<!--            <div class="place-item">-->
<!--                <div class="place-number">2</div>-->
<!--                <div class="place-info">-->
<!--                    <div class="place-name">안 방 비치</div>-->
<!--                    <div class="place-category">관광명소 · 호이안</div>-->
<!--                </div>-->
<!--                <button class="btn-review">리뷰쓰기</button>-->
<!--            </div>-->
<!--            <div class="place-item">-->
<!--                <div class="place-number">3</div>-->
<!--                <div class="place-info">-->
<!--                    <div class="place-name">쿠쿤</div>-->
<!--                    <div class="place-category">음식점 · 호이안</div>-->
<!--                </div>-->
<!--                <button class="btn-review">리뷰쓰기</button>-->
<!--            </div>-->
<!--            <div class="place-item">-->
<!--                <div class="place-number">4</div>-->
<!--                <div class="place-info">-->
<!--                    <div class="place-name">실크 센세 호이 안 리버 리조트</div>-->
<!--                    <div class="place-category">4성급 · 호이안</div>-->
<!--                </div>-->
<!--                <button class="btn-review">리뷰쓰기</button>-->
<!--            </div>-->
<!--            <div class="place-item">-->
<!--                <div class="place-number">5</div>-->
<!--                <div class="place-info">-->
<!--                    <div class="place-name">호이안 구시가지</div>-->
<!--                    <div class="place-category">관광명소 · 호이안</div>-->
<!--                </div>-->
<!--                <button class="btn-review">리뷰쓰기</button>-->
<!--            </div>-->
<!--            <div class="place-item">-->
<!--                <div class="place-number">6</div>-->
<!--                <div class="place-info">-->
<!--                    <div class="place-name">호이안 야시장</div>-->
<!--                    <div class="place-category">쇼핑 · 호이안</div>-->
<!--                </div>-->
<!--                <button class="btn-review">리뷰쓰기</button>-->
<!--            </div>-->
<!--            <div class="place-item">-->
<!--                <div class="place-number">7</div>-->
<!--                <div class="place-info">-->
<!--                    <div class="place-name">실크 센세 호이 안 리버 리조트</div>-->
<!--                    <div class="place-category">4성급 · 호이안</div>-->
<!--                </div>-->
<!--                <button class="btn-review">리뷰쓰기</button>-->
<!--            </div>-->
<!--            <div class="action-buttons">-->
<!--                <button class="btn-add-place">장소 추가</button>-->
<!--                <button class="btn-add-memo">메모 추가</button>-->
<!--            </div>-->

            <div class="place-item">
                <div class="place-number-container">
                    <div class="place-number">1</div>
                    <div class="place-time">11:00</div>
                </div>
                <div class="place-info">
                    <div class="place-name">간사이 국제공항</div>
                    <div class="place-category">관광명소</div>
                </div>
            </div>
            <div class="place-item">
                <div class="place-number-container">
                    <div class="place-number">2</div>
                    <div class="place-time">12:00</div>
                </div>
                <div class="place-info">
                    <div class="place-name">도톤보리</div>
                    <div class="place-category">관광명소 · 난바</div>
                </div>
            </div>
            <div class="place-item">
                <div class="place-number-container">
                    <div class="place-number">3</div>
                    <div class="place-time">13:00</div>
                </div>
                <div class="place-info">
                    <div class="place-name">구로몬 시장</div>
                    <div class="place-category">쇼핑 · 난바</div>
                </div>
            </div>
            <div class="place-item">
                <div class="place-number-container">
                    <div class="place-number">4</div>
                    <div class="place-time">14:30</div>
                </div>
                <div class="place-info">
                    <div class="place-name">덴덴 타운</div>
                    <div class="place-category">쇼핑 · 난바</div>
                </div>
            </div>
            <div class="place-item">
                <div class="place-number-container">
                    <div class="place-number">5</div>
                    <div class="place-time">16:00</div>
                </div>
                <div class="place-info">
                    <div class="place-name">난바 파크스</div>
                    <div class="place-category">쇼핑 · 난바</div>
                </div>
            </div>
            <div class="place-item">
                <div class="place-number-container">
                    <div class="place-number">6</div>
                    <div class="place-time">17:30</div>
                </div>
                <div class="place-info">
                    <div class="place-name">아메리카 무라</div>
                    <div class="place-category">관광명소 · 난바</div>
                </div>
            </div>
            <div class="action-buttons">
                <button class="btn-schedule">
                    <i class="fas fa-calendar-plus"></i> 내 일정으로 담기
                </button>
            </div>

            <!-- Font Awesome CDN 추가 -->
            <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>





            <section id="commentsSection">
                <h3>댓글</h3>
                <form id="commentForm" method="post" action="/comment/add">
                    <input type="hidden" id="planId" name="planId" th:value="${selectedPlan.planId}">
                    <input type="hidden" id="userId" name="userId" th:value="${user.userId}" readonly>
                    <input type="hidden" id="nickname" name="nickname" th:value="${user.nickname}" readonly>
                    <textarea id="comments" name="comments" rows="4" cols="50" placeholder="댓글을 입력하세요" required></textarea><br>
                    <button type="submit" class="btn-submit">
                        <i class="fas fa-paper-plane"></i> 댓글 작성
                    </button>
                </form>

                <!-- 수정 버튼 선택 시 폼 여는 스크립트-->
                <script th:inline="javascript">
                    function toggleEditForm(commentId) {
                        var form = document.getElementById('edit-form-' + commentId);
                        if (form.style.display === 'none') {
                            form.style.display = 'block';
                        } else {
                            form.style.display = 'none';
                        }
                    }
                </script>

                <div th:each="comment : ${comments}" class="comment">
                    <p><strong th:text="${comment.user.nickname}"></strong>
                        <span class="comment-date" th:text="${#temporals.format(comment.createdAt, 'yyyy. M. d. a h:mm:ss')}"></span></p>
                    <p th:text="${comment.content}"></p>
                    <div th:if="${user != null and user.nickname == comment.user.nickname}" class="comment-actions">
                        <button th:onclick="'toggleEditForm(' + ${comment.commentId} + ')'"><i class="fas fa-edit"></i> 수정</button>
                        <form th:action="@{'/delete/' + ${comment.commentId}}" method="post" class="delete-form">
                            <input type="hidden" name="_method" value="delete">
                            <button type="submit"><i class="fas fa-trash-alt"></i> 삭제</button>
                        </form>
                    </div>

                    <div th:id="'edit-form-' + ${comment.commentId}" style="display: none;" class="edit-form">
                        <form th:action="@{'/modify/' + ${comment.commentId}}" method="post">
                            <input type="hidden" name="_method" value="post">
                            <textarea name="content" rows="4" cols="50" th:text="${comment.content}"></textarea><br>
                            <button type="submit" class="btn-submit"><i class="fas fa-save"></i> 수정 완료</button>
                        </form>
                    </div>
                </div>
            </section>
        </article>
        <div th:unless="${selectedPlan}">
            <p>선택된 여행 계획이 없습니다.</p>
        </div>
    </div>
</main>

<footer>
    <p>&copy; 2024 여행 계획 서비스. All rights reserved.</p>
</footer>
</body>
</html>
