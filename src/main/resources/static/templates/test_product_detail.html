<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>여행 계획 상세</title> <!-- 필요한 CSS 파일 연결 -->
</head>
<body>
<header>
    <h1>여행 계획 상세</h1>
    <!-- 네비게이션 메뉴 등 필요한 헤더 내용 추가 -->
</header>

<main>
    <article th:if="${selectedPlan}">
        <h2 th:text="${selectedPlan.title}">여행 계획 제목</h2>

        <section class="plan-details">
            <p><strong>국가:</strong> <span th:text="${selectedPlan.nation}"></span></p>
            <p><strong>작성자:</strong> <span th:text="${selectedPlan.user.userName}"></span></p>
            <p><strong>작성일:</strong> <span th:text="${#temporals.format(selectedPlan.createdAt, 'yyyy-MM-dd HH:mm')}"></span></p>
            <p><strong>최종 수정일:</strong> <span th:text="${#temporals.format(selectedPlan.updatedAt, 'yyyy-MM-dd HH:mm')}"></span></p>
            <p><strong>판매 수:</strong> <span th:text="${selectedPlan.sold}"></span></p>
            <p><strong>상태:</strong> <span th:text="${selectedPlan.status}"></span></p>
        </section>

        <section class="plan-content">
            <h3>상세 내용</h3>
            <div th:utext="${selectedPlan.detail}"></div>
        </section>

        <section class="plan-images">
            <h3>첨부 이미지</h3>
            <div th:if="${not #lists.isEmpty(selectedPlan.imagePaths)}">
                <div th:each="imagePath : ${selectedPlan.imagePaths}">
                    <img th:src="@{${imagePath}}" th:alt="${imagePath}">
                </div>

            </div>
            <p th:if="${#lists.isEmpty(selectedPlan.imagePaths)}">첨부된 이미지가 없습니다.</p>
        </section>

        <!-- 여기에 추가 기능 (예: 구매 버튼, 댓글 섹션 등)을 넣을 수 있습니다 -->

        <!-- cart기능 -->
        <section class="add-to-cart">
            <form th:action="@{/cart/add}" method="post">
                <input type="hidden" name="planId" th:value="${selectedPlan.planId}">
                <button type="submit" class="btn-add-to-cart">카트에 추가</button>
            </form>
        </section>

        <!-- 댓글 섹션 -->
        <div id="commentsSection">

            <!-- 댓글 추가 폼 -->
            <form id="commentForm" method="post" action="/comment/add">
                <input type="hidden" id="planId" name="planId" th:value="${selectedPlan.planId}">
                <input type="hidden" id="userId" name="userId" th:value="${user.userId}" readonly>
                <input type="hidden" id="nickname" name="nickname" th:value="${user.nickname}" readonly>
                <label for="comments">Content:</label><br>
                <textarea id="comments" name="comments" rows="4" cols="50" required></textarea><br><br>
                <button type="submit">등록</button>
            </form>

            <!-- 댓글이 존재하는 경우에만 출력 -->
            <div th:each="comment : ${comments}">
                <p><strong th:text="${comment.user.nickname}"></strong>: <span th:text="${comment.content}"></span></p>
                <p th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}"></p>

                <!-- 수정 버튼 선택 시 폼 여는 스크립트-->
                <script th:inline="javascript">
                    function toggleEditForm(commentId) {
                        var form = document.getElementById('edit-form-' + commentId);
                        if (form.style.display === 'none') {
                            form.style.display = 'block';
                        } else {
                            form.style.display = 'none';
                        }
                    }
                </script>

                <div th:if="${user != null and user.nickname == comment.user.nickname}">
                    <p th:text="${comment.content}"></p>
                    <button th:onclick="'toggleEditForm(' + ${comment.commentId} + ')'">수정</button>
                    <div th:id="'edit-form-' + ${comment.commentId}" style="display: none;">
                        <form th:action="@{'/modify/' + ${comment.commentId}}" method="post">
                            <input type="hidden" name="_method" value="post">
                            <div>
                                <label for="content">댓글 내용:</label>
                                <textarea id="content" name="content" rows="4" cols="50" th:text="${comment.content}"></textarea>
                            </div>
                            <button type="submit"></button>
                        </form>
                    </div>
                    <form th:action="@{'/delete/' + ${comment.commentId}}" method="post">
                        <input type="hidden" name="_method" value="delete">
                        <button type="submit">삭제</button>
                    </form>
                    <form th:action="@{/delete/{commentId}(commentId=${comment.commentId})}" method="post" class="delete-form">
                        <input type="hidden" name="_method" value="delete">
                        <button type="submit">삭제</button>
                    </form>
                </div>
            </div>
    </article>

    <div th:unless="${selectedPlan}">
        <p>선택된 여행 계획이 없습니다.</p>
    </div>
</main>

<footer>
    <!-- 푸터 내용 -->
    <p>&copy; 2023 여행 계획 서비스. All rights reserved.</p>
</footer>
</body>
</html>